<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lucky Committee — User</title>

  <!-- Jameel Noori Nastaleeq (Urdu) -->
  <link href="https://fonts.cdnfonts.com/css/jameel-noori-nastaleeq" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --orange:#ff7a00; --orange-2:#ff9b3a; --bg:#fff7f0; --muted:#6b6b6b;
      --card-radius:14px; --shadow:0 10px 30px rgba(11,11,11,0.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, Arial, sans-serif;background:linear-gradient(180deg,#fffaf5,#fff3e6);color:#111}
    a{color:inherit}

    /* Header */
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:linear-gradient(90deg,var(--orange),var(--orange-2));color:#fff;box-shadow:var(--shadow)}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;border-radius:12px;background:#fff;color:var(--orange);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:20px}
    .site-title{font-weight:800;font-size:18px}
    .nav-actions{display:flex;gap:10px;align-items:center}

    /* marquee */
    .marquee{background:#111;color:#fff;padding:10px;overflow:hidden}
    .marquee p{display:inline-block;white-space:nowrap;animation:marq 18s linear infinite;font-family:'Jameel Noori Nastaleeq', serif;font-size:18px}
    @keyframes marq{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

    /* layout */
    .container{max-width:1100px;margin:18px auto;padding:0 14px}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:20px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}

    /* draw card */
    .draw-card{background:linear-gradient(180deg,#fff,#fff6ee);border-radius:16px;padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px;align-items:center}
    .draw-title{font-weight:900;color:var(--orange);font-size:20px}
    .timer{font-weight:800;background:#fff;padding:8px 14px;border-radius:12px;border:1px solid #ffe8ce;color:var(--orange)}
    .participate-btn{background:linear-gradient(90deg,var(--orange),var(--orange-2));color:#fff;padding:10px 14px;border-radius:12px;border:none;font-weight:800;cursor:pointer;box-shadow:0 6px 18px rgba(255,122,0,0.18);transition:transform .14s}
    .participate-btn:hover{transform:translateY(-3px)}

    /* slider */
    .slider{margin-top:6px;border-radius:12px;overflow:hidden;height:220px;position:relative;box-shadow:var(--shadow)}
    .slides{display:flex;height:100%;transition:transform .7s cubic-bezier(.22,.9,.12,1)}
    .slide{min-width:100%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:28px;color:#222;padding:20px;background-size:cover;background-position:center}
    .slide .overlay{background:linear-gradient(180deg,rgba(255,255,255,0.7),rgba(255,255,255,0.15));padding:18px;border-radius:8px}

    /* draws list */
    .draws-list{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    .draw-item{background:#fff;border-radius:12px;padding:12px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 4px 16px rgba(0,0,0,0.06)}
    .draw-meta{display:flex;gap:12px;align-items:center}
    .pill{background:#fff7f0;padding:6px 10px;border-radius:999px;color:var(--orange);font-weight:800}

    /* right panel form */
    .panel{background:#fff;padding:16px;border-radius:12px;box-shadow:var(--shadow)}
    label{display:block;font-weight:700;margin-top:8px}
    input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #eee;margin-top:6px}
    .small{font-size:13px;color:var(--muted)}

    /* footer */
    footer{margin-top:18px;padding:18px;text-align:center;color:#666;font-size:14px}

    /* animations & micro */
    .fade-in{animation:fadeIn .6s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  </style>
</head>
<body>

  <script>
    // Set this to your backend once deployed (Render/Vercel). For demo leave as empty string.
    const API_BASE = ''; // e.g. 'https://committee-five.onrender.com'
  </script>

  <header>
    <div class="brand">
      <div class="logo">LC</div>
      <div>
        <div class="site-title">Lucky Committee</div>
        <div class="small">Join • Pay • Draw</div>
      </div>
    </div>

    <div class="nav-actions">
      <button class="participate-btn" onclick="openJoinPanel()">Join Now</button>
    </div>
  </header>

  <div class="marquee"><p>کمیٹی جمع کروانے کی آخری تاریخ دس ہوگی — آدھے پیسے کمیٹی کے بعد واپس کیے جائیں گے اور آدھے جمع کیے جائیں گے —</p></div>

  <div class="container fade-in">
    <div class="grid">

      <!-- left -->
      <div>
        <div class="draw-card">
          <div class="draw-title">Daily Prize Draw</div>
          <div class="small">Next draw at <strong id="nextDrawText">--</strong></div>
          <div class="timer" id="mainTimer">24:00:00</div>
          <div style="display:flex;gap:10px;margin-top:8px;align-items:center">
            <button class="participate-btn" onclick="openJoinPanel()">Participate</button>
            <button class="participate-btn" style="background:#111;color:#fff" onclick="openWinners()">Winners</button>
          </div>

          <div class="slider" id="mainSlider" aria-hidden="false">
            <div class="slides" id="slides">
              <div class="slide" style="background-image:url('images/slide1.jpg')"><div class="overlay">Win Big Cash Prizes</div></div>
              <div class="slide" style="background-image:url('images/slide2.jpg')"><div class="overlay">Secure & Fair Draw</div></div>
              <div class="slide" style="background-image:url('images/slide3.jpg')"><div class="overlay">Join With Easy Payment</div></div>
              <div class="slide" style="background-image:url('images/slide4.jpg')"><div class="overlay">Transparent Results</div></div>
            </div>
          </div>

          <div class="draws-list" id="drawsList"></div>
        </div>
      </div>

      <!-- right -->
      <aside>
        <div class="panel">
          <h3 style="color:var(--orange)">Quick Join</h3>
          <div class="small">Fill details & choose draw (demo)</div>
          <label>Your name</label><input id="u_name" placeholder="Full name" />
          <label>Phone</label><input id="u_phone" placeholder="03XXXXXXXXX" />
          <label>Select draw</label><select id="u_draw"><option value="">Loading...</option></select>
          <label>Payment method</label><select id="u_method"><option value="">Loading...</option></select>
          <div style="margin-top:10px;display:flex;gap:10px">
            <button class="participate-btn" style="flex:1" onclick="submitJoin()">Submit</button>
            <button class="btn" style="background:#fff;border:1px solid #eee;color:var(--orange);font-weight:800" onclick="clearJoinForm()">Clear</button>
          </div>
          <p id="joinMsg" class="small"></p>
        </div>
      </aside>

    </div>
  </div>

  <footer>
    <div style="display:flex;gap:16px;justify-content:center;align-items:center;flex-wrap:wrap">
      <img src="images/easypaisa.png" alt="EasyPaisa" style="height:38px">
      <img src="images/jazzcash.png" alt="JazzCash" style="height:38px">
      <img src="images/nayapay.png" alt="NayaPay" style="height:38px">
      <img src="images/sadapay.png" alt="SadaPay" style="height:38px">
      <img src="images/usdt.png" alt="USDT" style="height:38px">
    </div>
    <div style="margin-top:10px" class="small">© 2025 Lucky Committee — Demo</div>
  </footer>

  <!-- Join modal simple -->
  <div id="joinModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;z-index:150">
    <div style="background:#fff;padding:16px;border-radius:12px;width:92%;max-width:420px">
      <h3 style="margin:0;color:var(--orange)">Join Committee</h3>
      <div style="margin-top:10px">
        <label>Name</label><input id="jm_name" />
        <label>Phone</label><input id="jm_phone" />
        <label>Draw</label><select id="jm_draw"></select>
        <label>Method</label><select id="jm_method"></select>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="participate-btn" style="flex:1" onclick="confirmJoin()">Confirm</button>
          <button class="btn" style="background:#eee;color:#333;flex:1" onclick="closeJoin()">Cancel</button>
        </div>
        <p id="jm_msg" class="small"></p>
      </div>
    </div>
  </div>

<script>
/* ====== Demo frontend logic (works with API when API_BASE set) ====== */
const API = (typeof API_BASE !== 'undefined' && API_BASE) ? API_BASE : '';

// slider
let cur = 0;
const slidesEl = document.getElementById('slides');
setInterval(()=>{ cur=(cur+1)%4; slidesEl.style.transform = translateX(-${cur*100}%); }, 3600);

// demo draws & payments if no API
let draws = [];
let payments = [];

async function loadRemote(){
  if(!API) return loadDemoData();
  try{
    const [dres, pres] = await Promise.all([fetch(API+'/api/draws'), fetch(API+'/api/payments')]);
    draws = await dres.json(); payments = await pres.json();
  }catch(e){ console.warn('API load failed', e); loadDemoData(); }
  renderLists();
}
function loadDemoData(){
  draws = [
    { id:'d1', title:'100 PKR Committee', price:100, datetime: new Date(Date.now()+2*24*3600*1000).toISOString(), description:'Monthly small pool', status:'active', winner_json:null},
    { id:'d2', title:'200 PKR Committee', price:200, datetime: new Date(Date.now()+3*24*3600*1000).toISOString(), description:'Bi-monthly', status:'inactive', winner_json:null}
  ];
  payments = [
    { id:'pm1', provider:'EasyPaisa', value:'0300-XXXXX' },
    { id:'pm2', provider:'JazzCash', value:'0311-YYYYY' }
  ];
  renderLists();
}

function renderLists(){
  const drawsArea = document.getElementById('drawsList'); drawsArea.innerHTML='';
  const select = document.getElementById('u_draw'); select.innerHTML = '<option value="">Select draw</option>';
  const jm_draw = document.getElementById('jm_draw'); jm_draw.innerHTML = '<option value="">Select</option>';
  draws.forEach(d=>{
    const div = document.createElement('div'); div.className='draw-item';
    div.innerHTML = `<div class="draw-meta"><div>
      <div style="font-weight:800">${escapeHtml(d.title)}</div>
      <div class="small">${escapeHtml(d.description || '')}</div>
      </div></div>
      <div style="text-align:right">
        <div class="pill">${d.price} PKR</div>
        <div class="small" style="margin-top:6px">${d.datetime ? new Date(d.datetime).toLocaleString() : '-'}</div>
      </div>`;
    drawsArea.appendChild(div);
    select.insertAdjacentHTML('beforeend', <option value="${d.id}">${escapeHtml(d.title)} — ${d.price} PKR</option>);
    jm_draw.insertAdjacentHTML('beforeend', <option value="${d.id}">${escapeHtml(d.title)}</option>);
  });

  const pmSelect = document.getElementById('u_method'); pmSelect.innerHTML = '<option value="">Select method</option>';
  const jm_pm = document.getElementById('jm_method'); jm_pm.innerHTML = '<option value="">Select</option>';
  payments.forEach(p=>{ pmSelect.insertAdjacentHTML('beforeend', <option value="${p.id}">${p.provider} • ${p.value}</option>); jm_pm.insertAdjacentHTML('beforeend', <option value="${p.id}">${p.provider}</option>); });

  // next draw text
  const next = draws[0]; document.getElementById('nextDrawText').innerText = next ? new Date(next.datetime).toLocaleString() : '--';
  setupMainTimer(draws[0] ? new Date(draws[0].datetime).getTime() : Date.now() + 24*3600*1000);
}

function setupMainTimer(targetTs){
  let rem = Math.max(0, Math.floor((targetTs - Date.now())/1000));
  const el = document.getElementById('mainTimer');
  const tick = ()=>{ if(rem<=0){ el.innerText='00:00:00'; clearInterval(ti); return; } const h=Math.floor(rem/3600), m=Math.floor((rem%3600)/60), s=rem%60; el.innerText = ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}; rem--; }
  tick(); const ti = setInterval(tick,1000);
}

function openJoinPanel(){ document.getElementById('joinModal').style.display='flex'; document.getElementById('jm_name').value=document.getElementById('u_name').value || ''; document.getElementById('jm_phone').value=document.getElementById('u_phone').value || ''; }
function closeJoin(){ document.getElementById('joinModal').style.display='none'; }
function openWinners(){ alert('Winners panel (demo)'); }

function submitJoin(){
  const name = document.getElementById('u_name').value.trim(); const phone = document.getElementById('u_phone').value.trim(); const drawId = document.getElementById('u_draw').value; const method = document.getElementById('u_method').value;
  if(!name||!phone||!drawId){ document.getElementById('joinMsg').innerText='Please fill name, phone and select draw'; return; }
  if(!API){ document.getElementById('joinMsg').innerText='Demo submitted (local) — admin will confirm.'; console.log('Demo join', {name,phone,drawId,method}); return; }
  // POST to backend
  fetch(API+'/api/participants',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({name,phone,draw_id:drawId,method})})
    .then(r=>r.json()).then(d=>{ if(d.ok){ document.getElementById('joinMsg').innerText='Submitted — wait admin'; document.getElementById('u_name').value=''; document.getElementById('u_phone').value=''; }else document.getElementById('joinMsg').innerText='Error: '+(d.error||''); })
    .catch(()=> document.getElementById('joinMsg').innerText='Server error');
}

function clearJoinForm(){ document.getElementById('u_name').value=''; document.getElementById('u_phone').value=''; }

function confirmJoin(){
  const name = document.getElementById('jm_name').value.trim(); const phone = document.getElementById('jm_phone').value.trim(); const drawId = document.getElementById('jm_draw').value; const method = document.getElementById('jm_method').value;
  if(!name||!phone||!drawId){ document.getElementById('jm_msg').innerText='Please fill'; return; }
  if(!API){ document.getElementById('jm_msg').innerText='Demo entry added (local)'; closeJoin(); return; }
  fetch(API+'/api/participants',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({name,phone,draw_id:drawId,method})})
    .then(r=>r.json()).then(d=>{ if(d.ok){ document.getElementById('jm_msg').innerText='Submitted'; setTimeout(()=>closeJoin(),900)}else document.getElementById('jm_msg').innerText='Error'; })
    .catch(()=> document.getElementById('jm_msg').innerText='Server error');
}

function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','':'&#96;'}[c])); }

loadRemote();
setInterval(()=>{ if(API) loadRemote(); }, 7000);
</script>
</body>
</html>
